<!DOCTYPE html>
<html>
    <head>
        <link rel="stylesheet" href="{{ url_for('polls.static', filename='results.css') }}">
        <title>results</title>  
    </head>

    <body>
        <header id="loggedIn" class="header">
            <img style="cursor: pointer;" onclick="window.location.href='/'" id="logo" src="{{ url_for('static', filename='assets/logo.png') }}" >
    
            <nav class="navbar">
                <a href="/">Home</a>
                <a href="{{ url_for('home.about') }}">About</a>
                <a href="{{ url_for('home.contact') }}">Contact</a>
                <a href="{{ url_for('polls.mypolls') }}">My Polls</a>
                <a href="{{ url_for('polls.createpoll') }}">Create</a>
                <a href="{{ url_for('auth.logout') }}" class="start">Log Out</a>
            </nav>
        </header>

        <div class="wrapper">
            <div class="tab">
                <a class="tablinks active" onclick="openPoll(event, 'Pie')">Pie</a>
                <a class="tablinks" onclick="openPoll(event, 'Polls')">Polls</a>
                <a class="tablinks" onclick="openPoll(event, 'Votes')">Votes</a>
            </div>

            <div id="PieChart" class="tabcharts" style="display: flex;">
                <div class="slice"></div>
            </div>

            <div style="display: none;" id="PollsChart" class="tabcharts">
                {% for result in results %}    
                    <div class="poll">
                        <div class="bar" style="height: {{result.candidate_results}}%"></div>
                        <p>{{ result.candidate_name }}</p>
                    </div>
                {% endfor %}
            </div>

            <div style="display: none;" class="tabcharts" id="VotesChart">
                <h3>Results:</h3>
                {% for result in results%}
                    <p>{{result.candidate_name}} : {{result.candidate_results}}%</p>
                {% endfor %}
            </div>
        </div>
        <div class="menu">
            <button>Add Voter</button>
            <button>Remove Voter</button>
            <button>Change Date</button>
            <button>Delete Survey</button>
        </div>

    </body>
    <script src="{{ url_for('polls.static', filename='results.js') }}"></script>
    <script>
        
        const pieChart = document.getElementById('PieChart');

        function randomColor(baseColor, variation = 20) {
            const baseRGB = parseInt(baseColor.slice(1), 16);
            const red = (baseRGB >> 16) & 255;
            const green = (baseRGB >> 8) & 255;
            const blue = baseRGB & 255;

            const randomRed = (red + Math.floor(Math.random() * (variation * 2) - variation)) & 255;
            const randomGreen = (green + Math.floor(Math.random() * (variation * 2) - variation)) & 255;
            const randomBlue = (blue + Math.floor(Math.random() * (variation * 2) - variation)) & 255;

            const randomColor = `#${(1 << 24 | randomRed << 16 | randomGreen << 8 | randomBlue).toString(16).slice(1)}`;

            return randomColor;
        }




        function updateChart() {
            let gradient = '';
            let colors = '';
            let i = 0;
            {% for result in results %}
                var percentage = {{result.candidate_results}};
                var color = randomColor('#253e54');

                gradient += `${color} 0% ${percentage}%`;
                if (i !== {{results|length}} - 1) {
                    gradient += ', ';
                }
                colors += `var(--color${i + 1}: ${color}); `;
                i++;
            {% endfor %}

            pieChart.style.setProperty('--colors', gradient);
        }

        updateChart()
    </script>
</html>